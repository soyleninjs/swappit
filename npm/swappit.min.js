var g=Object.create;var f=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var b=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var v=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var C=(i,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of y(t))!E.call(i,a)&&a!==e&&f(i,a,{get:()=>t[a],enumerable:!(s=_(t,a))||s.enumerable});return i};var L=(i,t,e)=>(e=i!=null?g(b(i)):{},C(t||!i||!i.__esModule?f(e,"default",{value:i,enumerable:!0}):e,i));var m=v((S,d)=>{var h=class i{static instances=new Map;constructor(t,e=!1,s={}){if(!t)throw new Error("Swappit: Error - El par\xE1metro handle es obligatorio");if(i.instances.has(t))throw new Error(`Swappit: Error - El handle "${t}" ya est\xE1 en uso. Utilice un identificador diferente.`);this.handle=t,this.log=e,this.options={updateUrl:!1,enableHistory:!1,preload:!1,...s},i.instances.set(this.handle,this),this.contentsCache={},this._handleHistoryUpdate(),this._observeDOM(),this._logMessage("Nueva instancia creada","info")}_logMessage(t,e="info"){if(!this.log)return;let s={info:"#3498db",success:"#2ecc71",warning:"#f39c12",error:"#e74c3c"},a=s[e]||s.info,o=`%cSwappit [${this.handle}]:`;console.log(o,`color: ${a}; font-weight: bold;`,t)}async _getContent(t,e=!0){if(!t||!t.startsWith("/")&&!t.startsWith("./")){this._logMessage(`La URL "${t}" no es v\xE1lida. Solo se permiten rutas internas relativas.`,"error");return}if(!e||!this.contentsCache[t]){let a=await(await window.fetch(t)).text();this.contentsCache[t]=new window.DOMParser().parseFromString(a,"text/html"),this._logMessage(`Contenido precargado de ${t}`,"success")}}_updateDOM(t){let e=Array.from(document.querySelectorAll(`[data-${this.handle}-update]`)),s=e.filter(n=>n.hasAttribute(`data-${this.handle}-update-order`)),a=e.filter(n=>!n.hasAttribute(`data-${this.handle}-update-order`));s.sort((n,r)=>window.parseInt(n.getAttribute(`data-${this.handle}-update-order`))-window.parseInt(r.getAttribute(`data-${this.handle}-update-order`))),[...a,...s].forEach(n=>{let r=n.getAttribute(`data-${this.handle}-update`);t.querySelectorAll(`[data-${this.handle}-update="${r}"]`).forEach(p=>{if(p==null){n.classList.add("hidden");return}let w=p.cloneNode(!0);w.querySelectorAll("noscript").forEach(u=>{u.textContent=u.innerHTML}),n.replaceWith(w)})})}_emitCustomEvent(t,e=""){let s=`swappit:${this.handle}:${t}`;window.dispatchEvent(new window.CustomEvent(s,{detail:{handle:this.handle,url:e}}))}_handleHistoryUpdate(){this.options.updateUrl&&this.options.enableHistory&&(window._swappitHistoryUpdate&&window.removeEventListener("popstate",window._swappitHistoryUpdate),window._swappitHistoryUpdate=()=>this._handleHistoryUpdateCallback(),window.addEventListener("popstate",window._swappitHistoryUpdate))}async _handleHistoryUpdateCallback(){let t=window.location.pathname;await this._getContent(t),this._updateDOM(this.contentsCache[t])}_handleLinksToPreload(t){t.forEach(e=>{let{preload:s,loadFromCache:a}=e.dataset,o=e.getAttribute("href"),n=s||this.options.preload,r=a||!0;n==="instant"?this._getContent(o):n==="hover"&&(e.addEventListener("mouseenter",()=>{this._getContent(o)}),e.addEventListener("touchstart",()=>{this._getContent(o)},{passive:!0})),e._clickListener&&e.removeEventListener("click",e._clickListener),e._clickListener=l=>this._handleClickLink(l,o,r),e.addEventListener("click",e._clickListener)})}_handleClickLink(t,e,s){t.preventDefault(),this.update(e,s)}_observeNode(t){if(t.nodeType===1&&(t.matches(`a[data-swappit-handle="${this.handle}"]`)||t.querySelector(`a[data-swappit-handle="${this.handle}"]`))){t.matches(`a[data-swappit-handle="${this.handle}"]`)&&this._handleLinksToPreload([t]);let e=t.querySelectorAll(`a[data-swappit-handle="${this.handle}"]`);this._handleLinksToPreload(e)}}_observeDOM(){let t=document.querySelectorAll(`a[data-swappit-handle="${this.handle}"]`);this._handleLinksToPreload(t),this.observerLinks&&this.observerLinks.disconnect(),this.observerLinks=new window.MutationObserver(e=>{e.forEach(s=>{s.addedNodes.forEach(a=>this._observeNode(a))})}),this.observerLinks.observe(document.body,{childList:!0,subtree:!0})}async preloadContents(t){let e=[...new Set(t)];if(!Array.isArray(e)||e.length===0){this._logMessage("preloadContents requiere un array de URLs no vac\xEDo","warning");return}await Promise.all(e.map(s=>this._getContent(s))),this._logMessage(`Precarga completada para ${e.length} URL(s)`,"success")}async update(t,e=!0){this._emitCustomEvent("beforeUpdate",t),this.options.updateUrl&&(this.options.enableHistory?window.history.pushState({},"",t):window.history.replaceState({},"",t)),await this._getContent(t,e),this._updateDOM(this.contentsCache[t]),this._logMessage(`Elementos actualizados del contenido de ${t}`,"success"),this._emitCustomEvent("afterUpdate",t)}reinit(t=!1,e={}){this.log=t,this.options={...this.options,...e},this._handleHistoryUpdate(),this._observeDOM(),this._logMessage("Reinicio completado","success"),this._emitCustomEvent("reinit")}static updateScriptByContent(t){t.forEach(e=>{let s=document.createElement("script");s.textContent=e.textContent,e.replaceWith(s)})}static updateScriptBySrc(t){document.querySelectorAll(`script[src*="${t}"]`).forEach(s=>{let a=document.createElement("script");a.src=`${s.src}?timestamp=${new Date().getTime()}`,s.replaceWith(a)})}};window.Swappit=h;typeof d<"u"&&typeof d.exports<"u"&&(d.exports=h)});var $=L(m());var c=class extends HTMLElement{connectedCallback(){if(this.handle=this.dataset.handle,!this.handle){console.error("SwappitInstance: El atributo data-handle es obligatorio.");return}let t=this.hasAttribute("data-log"),e=this.hasAttribute("data-update-url"),s=this.hasAttribute("data-enable-history");this.loadFromCache=this.hasAttribute("data-load-from-cache"),this.destroyAfterRemove=this.hasAttribute("data-destroy-after-remove");let a=this.dataset.preload||!1;Swappit.instances.has(this.handle)?(this.swappit=Swappit.instances.get(this.handle),this.swappit.reinit(t,{updateUrl:e,enableHistory:s,preload:a})):this.swappit=new Swappit(this.handle,t,{updateUrl:e,enableHistory:s,preload:a})}disconnectedCallback(){this.destroyAfterRemove&&Swappit.instances.delete(this.handle)}};window.customElements.get("swappit-instance")||window.customElements.define("swappit-instance",c);
